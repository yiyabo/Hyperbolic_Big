# æ•°æ®é¢„å¤„ç†æ¨¡å—ä½¿ç”¨æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æ•°æ®é¢„å¤„ç†æ¨¡å—ä¸ºå±‚æ¬¡åŒ–ç‰¹å¾å»ºæ¨¡æä¾›å®Œæ•´çš„æ•°æ®è¿‡æ»¤å’Œå‡†å¤‡åŠŸèƒ½ï¼Œæ”¯æŒï¼š

- âœ… **PPIç½‘ç»œè¿‡æ»¤**: åŸºäºç½®ä¿¡åº¦å’Œè›‹ç™½è´¨è´¨é‡çš„å¤šé‡è¿‡æ»¤
- âœ… **è›‹ç™½è´¨è´¨é‡è¯„ä¼°**: åŸºäºé•¿åº¦ã€æ³¨é‡Šã€ç‰©ç§ç­‰çš„ç»¼åˆè´¨é‡è¯„åˆ†
- âœ… **MoEä¸“å®¶åˆ†ç»„**: åŸºäºSTRINGèšç±»çš„ä¸“å®¶æ¨¡å‹åˆ†ç»„
- âœ… **å›¾è¿é€šæ€§åˆ†æ**: ç¡®ä¿è¿‡æ»¤åçš„ç½‘ç»œè¿é€šæ€§
- âœ… **ç»Ÿè®¡åˆ†æå’Œå¯è§†åŒ–**: å…¨é¢çš„æ•°æ®ç»Ÿè®¡å’Œå›¾è¡¨ç”Ÿæˆ

## ğŸ—ï¸ æ¨¡å—ç»“æ„

```
data_preprocessing/
â”œâ”€â”€ __init__.py                 # æ¨¡å—å…¥å£
â”œâ”€â”€ ppi_filter.py              # PPIæ•°æ®è¿‡æ»¤å™¨
â”œâ”€â”€ protein_filter.py          # è›‹ç™½è´¨è´¨é‡è¿‡æ»¤å™¨
â”œâ”€â”€ cluster_analyzer.py        # èšç±»åˆ†æå™¨
â””â”€â”€ data_statistics.py         # æ•°æ®ç»Ÿè®¡åˆ†æå™¨

run_data_preprocessing.py       # ä¸»è¿è¡Œè„šæœ¬
test_data_preprocessing.py      # æµ‹è¯•è„šæœ¬
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. è¿è¡Œå®Œæ•´çš„é¢„å¤„ç†æµç¨‹

```bash
# ä½¿ç”¨é»˜è®¤å‚æ•°ï¼ˆæ¨èï¼‰
python run_data_preprocessing.py

# è‡ªå®šä¹‰å‚æ•°
python run_data_preprocessing.py \
    --confidence 0.7 \
    --quality-threshold 0.5 \
    --max-experts 50 \
    --min-cluster-size 100
```

### 2. æµ‹è¯•åŠŸèƒ½

```bash
# è¿è¡ŒåŠŸèƒ½æµ‹è¯•ï¼ˆä½¿ç”¨å°æ ·æœ¬ï¼‰
python test_data_preprocessing.py
```

## âš™ï¸ ä¸»è¦å‚æ•°è¯´æ˜

### è¿‡æ»¤å‚æ•°
- `--confidence`: PPIç½®ä¿¡åº¦é˜ˆå€¼ (0-1, é»˜è®¤0.7)
- `--quality-threshold`: è›‹ç™½è´¨è´¨é‡é˜ˆå€¼ (0-1, é»˜è®¤0.5)

### MoEä¸“å®¶å‚æ•°
- `--max-experts`: æœ€å¤§ä¸“å®¶ç»„æ•°é‡ (é»˜è®¤50)
- `--min-cluster-size`: ä¸“å®¶ç»„æœ€å°èšç±»å¤§å° (é»˜è®¤100)
- `--use-hierarchical`: ä½¿ç”¨å±‚æ¬¡åŒ–ä¸“å®¶åˆ†ç»„
- `--hierarchical-depth`: å±‚æ¬¡èšç±»æ·±åº¦ (é»˜è®¤2)

### è¾“å‡ºæ§åˆ¶
- `--data-dir`: è¾“å…¥æ•°æ®ç›®å½• (é»˜è®¤data)
- `--output-dir`: è¾“å‡ºç›®å½• (é»˜è®¤data/filtered)
- `--analysis-dir`: åˆ†æç»“æœç›®å½• (é»˜è®¤analysis_results)
- `--skip-plots`: è·³è¿‡ç»˜å›¾

## ğŸ“Š è¾“å‡ºæ–‡ä»¶è¯´æ˜

### ä¸»è¦æ•°æ®æ–‡ä»¶
```
data/filtered/
â”œâ”€â”€ filtered_proteins_conf0.7.csv      # è¿‡æ»¤åçš„è›‹ç™½è´¨æ•°æ®
â”œâ”€â”€ filtered_ppi_conf0.7.csv           # è¿‡æ»¤åçš„PPIæ•°æ®
â”œâ”€â”€ expert_groups_conf0.7.json         # MoEä¸“å®¶åˆ†ç»„
â””â”€â”€ filtering_stats_conf0.7.json       # è¿‡æ»¤ç»Ÿè®¡ä¿¡æ¯
```

### åˆ†æç»“æœ
```
analysis_results/
â”œâ”€â”€ comprehensive_data_report.json     # ç»¼åˆæ•°æ®æŠ¥å‘Š
â”œâ”€â”€ ppi_network_statistics.png         # PPIç½‘ç»œç»Ÿè®¡å›¾è¡¨
â””â”€â”€ protein_statistics.png             # è›‹ç™½è´¨ç»Ÿè®¡å›¾è¡¨
```

## ğŸ”§ é«˜çº§ä½¿ç”¨

### 1. å•ç‹¬ä½¿ç”¨å„æ¨¡å—

```python
from data_preprocessing import PPIDataFilter, ClusterAnalyzer, DataStatistics

# PPIæ•°æ®è¿‡æ»¤
ppi_filter = PPIDataFilter(confidence_threshold=0.7)
proteins_df, ppi_df, files = ppi_filter.run_complete_filtering()

# èšç±»åˆ†æ
cluster_analyzer = ClusterAnalyzer()
expert_groups = cluster_analyzer.get_moe_expert_groups()

# ç»Ÿè®¡åˆ†æ
stats_analyzer = DataStatistics()
report = stats_analyzer.generate_comprehensive_report(proteins_df, ppi_df)
```

### 2. è‡ªå®šä¹‰è¿‡æ»¤ç­–ç•¥

```python
# è‡ªå®šä¹‰è›‹ç™½è´¨è´¨é‡è¿‡æ»¤
from data_preprocessing.protein_filter import ProteinQualityFilter

quality_filter = ProteinQualityFilter()
# ä¿®æ”¹è¿‡æ»¤å‚æ•°
quality_filter.length_limits['min_length'] = 30
quality_filter.length_limits['max_length'] = 3000

filtered_proteins, stats = quality_filter.filter_proteins(protein_df)
```

### 3. ä¸åŒçš„ä¸“å®¶åˆ†ç»„ç­–ç•¥

```python
# å¹³é“ºèšç±»ç­–ç•¥
expert_groups = cluster_analyzer.get_moe_expert_groups(
    min_cluster_size=200,
    max_num_experts=30
)

# å±‚æ¬¡åŒ–ç­–ç•¥
hierarchical_groups = cluster_analyzer.get_hierarchical_expert_groups(
    target_depth=3
)

# éšæœºåˆ†ç»„ç­–ç•¥ï¼ˆå¤‡é€‰ï¼‰
random_groups = cluster_analyzer._create_random_expert_groups(
    num_experts=20,
    protein_list=list(proteins_df['protein_id'])
)
```

## ğŸ“ˆ æ•°æ®è´¨é‡æ§åˆ¶

### è›‹ç™½è´¨è´¨é‡è¯„åˆ†æ ‡å‡†

- **é•¿åº¦åˆ†æ•°** (30%æƒé‡):
  - æœ€ä½³é•¿åº¦: 100-1000 æ°¨åŸºé…¸ â†’ 1.0åˆ†
  - å¯æ¥å—é•¿åº¦: 50-5000 æ°¨åŸºé…¸ â†’ 0.5-1.0åˆ†
  - å¼‚å¸¸é•¿åº¦: <50 æˆ– >5000 â†’ 0.0åˆ†

- **æ³¨é‡Šåˆ†æ•°** (40%æƒé‡):
  - é«˜è´¨é‡å…³é”®è¯: +0.2åˆ† (characterized, enzymeç­‰)
  - ä½è´¨é‡å…³é”®è¯: -0.15åˆ† (hypothetical, fragmentç­‰)
  - é¢„æµ‹æ–¹æ³•: -0.05åˆ† (computational analysisç­‰)

- **åç§°åˆ†æ•°** (20%æƒé‡):
  - æ ‡å‡†åŸºå› å: +0.2åˆ† (acsA, hsp70ç­‰)
  - é€šç”¨ID: -0.1åˆ† (ABC123.1ç­‰)

- **ç‰©ç§åˆ†æ•°** (10%æƒé‡):
  - æ¨¡å¼ç”Ÿç‰©: 0.8-1.0åˆ†
  - å…¶ä»–ç‰©ç§: 0.6åˆ†

### PPIè¿‡æ»¤ç­–ç•¥

1. **ç½®ä¿¡åº¦è¿‡æ»¤**: combined_score â‰¥ threshold Ã— 1000
2. **è›‹ç™½è´¨è´¨é‡è¿‡æ»¤**: åªä¿ç•™è´¨é‡è¯„åˆ†åˆæ ¼çš„è›‹ç™½è´¨
3. **å›¾è¿é€šæ€§è¿‡æ»¤**: ä¿ç•™æœ€å¤§è¿é€šåˆ†é‡
4. **å¤šé€šé“è¯æ®åˆ†æ**: åˆ†æ8ä¸ªè¯æ®é€šé“çš„è´¡çŒ®

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**Q: èšç±»æ–‡ä»¶ä¸å­˜åœ¨æ€ä¹ˆåŠï¼Ÿ**
A: ç³»ç»Ÿä¼šè‡ªåŠ¨é™çº§ä½¿ç”¨éšæœºåˆ†ç»„ç­–ç•¥ï¼Œä¸å½±å“ä¸»æµç¨‹ã€‚

**Q: å†…å­˜ä¸è¶³æ€ä¹ˆåŠï¼Ÿ**
A: å¯ä»¥å¢åŠ chunk_sizeå‚æ•°æˆ–åœ¨ä»£ç ä¸­è°ƒæ•´æ‰¹å¤„ç†å¤§å°ã€‚

**Q: è¿‡æ»¤åæ•°æ®å¤ªå°‘æ€ä¹ˆåŠï¼Ÿ**
A: é™ä½ç½®ä¿¡åº¦é˜ˆå€¼ï¼ˆå¦‚0.6ï¼‰æˆ–è´¨é‡é˜ˆå€¼ï¼ˆå¦‚0.4ï¼‰ã€‚

**Q: å›¾ä¸è¿é€šæ€ä¹ˆåŠï¼Ÿ**
A: ç³»ç»Ÿä¼šè‡ªåŠ¨ä¿ç•™æœ€å¤§è¿é€šåˆ†é‡ï¼Œå°çš„è¿é€šåˆ†é‡ä¼šè¢«è¿‡æ»¤ã€‚

### æ€§èƒ½ä¼˜åŒ–

- **å¹¶è¡Œå¤„ç†**: å¯ä»¥ä¿®æ”¹ä»£ç æ”¯æŒå¤šè¿›ç¨‹å¤„ç†
- **å†…å­˜ä¼˜åŒ–**: ä½¿ç”¨chunkingç­–ç•¥å¤„ç†å¤§æ–‡ä»¶
- **å­˜å‚¨ä¼˜åŒ–**: ä½¿ç”¨HDF5æˆ–Parquetæ ¼å¼å­˜å‚¨å¤§æ•°æ®

## ğŸ“‹ é¢„æœŸè¾“å‡ºç¤ºä¾‹

```
================================================================================
                      æ•°æ®å¤„ç†æ‘˜è¦æŠ¥å‘Š
================================================================================

ğŸ“Š åŸºç¡€æ•°æ®ç»Ÿè®¡:
   è›‹ç™½è´¨æ€»æ•°: 1,234,567
   ç›¸äº’ä½œç”¨æ€»æ•°: 5,678,901
   ç½‘ç»œä¸­è›‹ç™½è´¨æ•°: 987,654
   å¹³å‡åº¦æ•°: 11.49

ğŸ§¬ è›‹ç™½è´¨å±æ€§:
   å¹³å‡é•¿åº¦: 345.2 Â± 198.7
   é•¿åº¦èŒƒå›´: 50 - 4999
   ç‰©ç§æ•°é‡: 4,521
   å¹³å‡è´¨é‡åˆ†æ•°: 0.634
   é«˜è´¨é‡è›‹ç™½è´¨: 456,789 (37.0%)

ğŸ”— PPIç½‘ç»œå±æ€§:
   å¹³å‡ç½®ä¿¡åº¦: 823.4
   ç½®ä¿¡åº¦èŒƒå›´: 700 - 999
   è¯æ®é€šé“ä½¿ç”¨ç‡:
     experimental: 23.4%
     database: 45.6%
     textmining: 78.9%
     coexpression: 34.2%

ğŸ­ MoEä¸“å®¶ç»„:
   ä¸“å®¶ç»„æ•°é‡: 42
   è¦†ç›–è›‹ç™½è´¨: 876,543
   å¹³å‡ç»„å¤§å°: 20,870.5 Â± 15,432.1
   ç»„å¤§å°èŒƒå›´: 123 - 89,456

ğŸ“ˆ æ•°æ®è¿‡æ»¤æ•ˆæœ:
   è›‹ç™½è´¨ä¿ç•™ç‡: 67.8%
   PPIä¿ç•™ç‡: 23.4%

================================================================================
âœ… æ•°æ®é¢„å¤„ç†å®Œæˆï¼Œå¯ä»¥å¼€å§‹PSSMç”Ÿæˆï¼
================================================================================
```

## ğŸ”— ä¸‹ä¸€æ­¥

æ•°æ®é¢„å¤„ç†å®Œæˆåï¼Œæ‚¨å¯ä»¥ï¼š

1. **å¼€å§‹PSSMç”Ÿæˆ**: ä½¿ç”¨è¿‡æ»¤åçš„è›‹ç™½è´¨åºåˆ—
2. **è®¾è®¡å°æ³¢å˜æ¢**: åŸºäºPSSMçŸ©é˜µ
3. **è®­ç»ƒMoEæ¨¡å‹**: ä½¿ç”¨ä¸“å®¶åˆ†ç»„ä¿¡æ¯
4. **æ„å»ºHGCN**: ä½¿ç”¨è¿‡æ»¤åçš„PPIç½‘ç»œ

é¢„å¤„ç†çš„è¾“å‡ºæ•°æ®å·²ç»é’ˆå¯¹æ‚¨çš„å±‚æ¬¡åŒ–ç‰¹å¾å»ºæ¨¡æ¡†æ¶è¿›è¡Œäº†ä¼˜åŒ–ï¼